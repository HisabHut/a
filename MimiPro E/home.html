<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>MimiPro Employee</title>
    
    <!-- Global error handler - MUST load first -->
    <script>
      window.addEventListener('unhandledrejection', function(e) {
        const errorMessage = e.reason?.message || e.reason?.toString() || '';
        if (errorMessage.includes('subscribeInfo') || 
            errorMessage.includes('messaging') ||
            errorMessage.includes('Installations') ||
            errorMessage.includes('FCM')) {
          console.warn('âš ï¸ Firebase Messaging/FCM error suppressed (not used):', errorMessage);
          e.preventDefault();
          return;
        }
        console.error('ğŸš¨ Unhandled Promise Rejection:', e.reason);
      });
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
</head>
<body>
    <div class="app-shell">
        <header class="top-header">
            <div class="header-left">
                <button class="menu-btn" id="menuBtn">â˜°</button>
                <div class="brand">
                    <h1><span class="brand-name">Mimi</span><span class="brand-pro">Pro</span></h1>
                    <p id="employeeName">Employee</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="syncBtn" title="Sync Data">
                    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
            </div>
        </header>

        <div class="side-nav-overlay" id="sideNavOverlay"></div>
        
        <aside class="side-nav" id="sideNav">
            <h2 class="side-title">Menu</h2>
            <nav class="side-links">
                <a class="side-link" href="#dashboard"><span class="side-icon">ğŸ </span><span class="side-text">Dashboard</span></a>
                <a class="side-link" href="#attendance"><span class="side-icon">ğŸ“…</span><span class="side-text">My Attendance</span></a>
                <a class="side-link" href="#advances"><span class="side-icon">ğŸ’°</span><span class="side-text">My Advances</span></a>
                <a class="side-link" href="#profile"><span class="side-icon">ğŸ‘¤</span><span class="side-text">Profile</span></a>
                <a class="side-link" id="logoutBtn"><span class="side-icon">ğŸšª</span><span class="side-text">Logout</span></a>
            </nav>
        </aside>

        <main class="page-content" id="pageContent">
            <section class="page" id="dashboard-page">
                <h2>Loading...</h2>
            </section>
        </main>

        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="dashboard">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                </svg>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-btn" data-page="attendance">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span class="nav-label">Attendance</span>
            </button>
            <button class="nav-btn" data-page="advances">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                    <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
                <span class="nav-label">Advances</span>
            </button>
            <button class="nav-btn" data-page="profile">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span class="nav-label">Profile</span>
            </button>
        </nav>
    </div>

    <!-- Utils -->
    <script src="utils/date.js"></script>
    <script src="utils/money.js"></script>
    <script src="utils/ui.js"></script>
    
    <!-- Database -->
    <script src="db/indexeddb.js"></script>
    
    <!-- Sync -->
    <script src="sync/firestore.js"></script>
    <script src="sync/employee-sync-service.js"></script>
    
    <!-- Auth -->
    <script src="auth/session.js"></script>
    
    <!-- Pages -->
    <script src="pages/dashboard/dashboard.js"></script>
    <script src="pages/attendance/attendance.js"></script>
    <script src="pages/advances/advances.js"></script>
    <script src="pages/deliveries/deliveries.js"></script>
    <script src="pages/profile/profile.js"></script>
    
    <!-- App -->
    <script src="assets/js/app.js"></script>
    <script src="assets/js/router.js"></script>
</body>
</html>
